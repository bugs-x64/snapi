# SnapiWebApi

![memes](https://img.memecdn.com/Has-your-life-changed-since-The-Social-Network-came-out_o_79675.jpg)

Приложение разбито на слои: 
* слой представления - SnapiController
* слой бизнес-логики - UsersService
* слой данных (условно за счет EFCore)

### Представление:
* Ошибки 500 возвращают текст-заглушку, стектрейс и текст ошибки пишутся в лог. По идее это нужно только на проде, так при необходимости можно сделать опцию, чтобы через конфиг appsettings управлять выводом информации
* Шаблон роута к апи вынесен в константу, чтобы чуть более надежным способом избежать ошибок в шаблоне роута
* За счет использования ***Result<TStatus, TValue>*** в сервисе не приходится городить огороды проверок в контроллере


### Несколько фактов по слою бизнес-логики:
* В слое бизнес-логики используется ***Result<TStatus, TValue>***. **Преимущества**: упрощается тестирование и использование методов, за счет известных статусов выполнения операции. Уменьшается кол-во конструкций try-catch в коде и проверок на null, про которые люди часто забывают. **Недостатки**: Приходится тратить время на создание и написание енума статусов. Если программист ошибся и вернул null значение в успешном ответе, проверка на null все равно понадобится(проблема обычно решается тестами)
* факт только один

### Что с БД:
* Добавлено два уникальных индекса на поля. В таблице users на индексируемое имя(имя юзера без пробелов в нижнем регистре), в таблице Subscribers на составной ключ FromId, ToId. Сделано это, чтобы гарантировать уникальность записей, т.е. юзеры уникальны по фио, а подписки по паре {"Кто подписался" "На кого подписались"}

### Модели:

* Так как приложение делится на слои, модели делим по тому же принципу. Модели БД лежат в папке Data/Models. Модели бизнес-логики лежат в папке Models(да, сейчас там нет моделей, добавим в следующем релизе). Модели слоя представления лежат в папке Dto. Все это в проекте SnapiCore. При необходимости их можно будет разнести в отдельные проекты
* Чтобы не создавать прямую зависимость между моделями, существует посредник DtoConverter

### Прочее
* в папке Data лежит powershell скрипт для создания миграций, чтобы не искать каждый раз при необходимости создания

